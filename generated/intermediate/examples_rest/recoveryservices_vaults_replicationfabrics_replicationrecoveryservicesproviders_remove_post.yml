- hosts: localhost
  roles:
    - ../modules
  vars_files:
    - _vars.yml
  vars:
    subscription_name: mySubscription
    resource_group: myResourceGroup
    vault_name: myVault
    replication_fabric_name: myReplicationFabric
    replication_recovery_services_provider_name: myReplicationRecoveryServicesProvider
  tasks:
    - name: >-
        Deletes provider from fabric. Note: Deleting provider for any fabric
        other than SingleHost is unsupported. To maintain backward compatibility
        for released clients the object "deleteRspInput" is used (if the object
        is empty we assume that it is old client and continue the old behavior).
      azure_rm_resource:
        method: POST
        api_version: '2018-07-10'
        resource_group: '{{ resource_group }}'
        provider: RecoveryServices
        resource_type: vaults
        resource_name: '{{ vault_name }}'
        subresource:
          - type: replicationFabrics
            name: '{{ replication_fabric_name }}'
          - type: replicationRecoveryServicesProviders
            name: '{{ replication_recovery_services_provider_name }}'
          - type: remove
        body: !<tag:yaml.org,2002:js/undefined> ''
